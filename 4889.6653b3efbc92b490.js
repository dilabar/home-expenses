"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4889],{4889:(E,d,p)=>{p.r(d),p.d(d,{LoginPage:()=>T});var y=p(467),c=p(177),l=p(4341),t=p(4438);function _(r,s){if(1&r){const e=t.RV6();t.j41(0,"input",4,0),t.bIt("paste",function(i){t.eBV(e);const o=t.XpG(2);return t.Njj(o.handlePaste(i))})("keyup",function(i){const o=t.eBV(e).index,a=t.XpG(2);return t.Njj(a.onKeyUp(i,o))})("input",function(i){t.eBV(e);const o=t.XpG(2);return t.Njj(o.onInput(i))})("keydown",function(i){const o=t.eBV(e).index,a=t.XpG(2);return t.Njj(a.onKeyDown(i,o))}),t.k0s()}if(2&r){const e=s.$implicit,n=s.index,i=t.XpG(2);t.ZvI("otp-input ",i.config.inputClass,""),t.Y8G("pattern",i.config.allowNumbersOnly?"\\d*":"")("type",i.inputType)("placeholder",(null==i.config?null:i.config.placeholder)||"")("ngStyle",i.config.inputStyles)("formControl",i.otpForm.controls[e])("id",i.getBoxId(n))}}function C(r,s){if(1&r&&(t.j41(0,"div",2),t.DNE(1,_,2,9,"input",3),t.nI1(2,"keys"),t.k0s()),2&r){const e=t.XpG();t.ZvI("ng-otp-input-wrapper wrapper ",e.config.containerClass,""),t.Mz_("id","c_",e.componentKey,""),t.Y8G("ngStyle",e.config.containerStyles),t.R7$(),t.Y8G("ngForOf",t.bMT(2,7,null==e.otpForm?null:e.otpForm.controls))}}class g{static ifTab(s){return this.ifKey(s,"Tab")}static ifDelete(s){return this.ifKey(s,"Delete;Del")}static ifBackspace(s){return this.ifKey(s,"Backspace")}static ifRightArrow(s){return this.ifKey(s,"ArrowRight;Right")}static ifLeftArrow(s){return this.ifKey(s,"ArrowLeft;Left")}static ifSpacebar(s){return this.ifKey(s,"Spacebar; ")}static ifKey(s,e){return e.split(";").some(i=>i===s.key)}}let f=(()=>{class r{transform(e){return Object.keys(e)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275pipe=t.EJ8({name:"keys",type:r,pure:!0}),r})(),v=(()=>{class r{constructor(e,n){this.keysPipe=e,this.document=n,this.config={length:4},this.onInputChange=new t.bkB,this.inputControls=new Array(this.config.length),this.componentKey=Math.random().toString(36).substring(2)+(new Date).getTime().toString(36)}get inputType(){var e,n;return null!==(e=this.config)&&void 0!==e&&e.isPasswordInput?"password":null!==(n=this.config)&&void 0!==n&&n.allowNumbersOnly?"tel":"text"}ngOnInit(){this.otpForm=new l.gE({});for(let e=0;e<this.config.length;e++)this.otpForm.addControl(this.getControlName(e),new l.MJ);this.otpForm.valueChanges.subscribe(e=>{this.keysPipe.transform(this.otpForm.controls).forEach(n=>{var i=this.otpForm.controls[n].value;i&&i.length>1&&(i.length>=this.config.length?this.setValue(i):this.rebuildValue())})})}ngAfterViewInit(){if(!this.config.disableAutoFocus){const e=this.document.getElementById(`c_${this.componentKey}`);if(e){const n=e.getElementsByClassName("otp-input")[0];n&&n.focus&&n.focus()}}}getControlName(e){return`ctrl_${e}`}onKeyDown(e,n){const i=this.getBoxId(n-1),o=this.getBoxId(n);return g.ifSpacebar(e)?(e.preventDefault(),!1):g.ifBackspace(e)?(e.target.value?this.clearInput(o,n):(this.clearInput(i,n-1),this.setSelected(i)),void this.rebuildValue()):void 0}onInput(e){if(this.config.allowNumbersOnly&&!this.validateNumber(this.currentVal?`${this.currentVal}${e.target.value}`:e.target.value))return e.target.value="",e.stopPropagation(),void e.preventDefault()}onKeyUp(e,n){g.ifTab(e)&&(n-=1);const i=this.getBoxId(n+1),o=this.getBoxId(n-1),a=this.getBoxId(n);return g.ifRightArrow(e)?(e.preventDefault(),void this.setSelected(i)):g.ifLeftArrow(e)?(e.preventDefault(),void this.setSelected(o)):g.ifDelete(e)?(e.target.value?this.clearInput(a,n):(this.clearInput(o,n-1),this.setSelected(o)),void this.rebuildValue()):void(e.target.value&&(this.ifValidKeyCode(e)&&this.setSelected(i),this.rebuildValue()))}validateNumber(e){return e&&/^[0-9]+$/.test(e)}getBoxId(e){return`otp_${e}_${this.componentKey}`}clearInput(e,n){var i;let o=this.getControlName(n);null===(i=this.otpForm.controls[o])||void 0===i||i.setValue(null);const a=this.document.getElementById(e);a&&a instanceof HTMLInputElement&&(a.value=null)}setSelected(e){this.focusTo(e);const n=this.document.getElementById(e);n&&n.setSelectionRange&&setTimeout(()=>{n.setSelectionRange(0,1)},0)}ifValidKeyCode(e){const n=e.key;return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||/[a-zA-Z0-9-_]/.test(n)}focusTo(e){const n=this.document.getElementById(e);n&&n.focus()}setValue(e){if(!this.config.allowNumbersOnly||!isNaN(e)){if(this.otpForm.reset(),!e)return void this.rebuildValue();if(e=e.toString().replace(/\s/g,""),Array.from(e).forEach((i,o)=>{this.otpForm.get(this.getControlName(o))&&this.otpForm.get(this.getControlName(o)).setValue(i)}),!this.config.disableAutoFocus){const i=this.document.getElementById(`c_${this.componentKey}`);var n=e.length<this.config.length?e.length:this.config.length-1;let o=i.getElementsByClassName("otp-input")[n];o&&o.focus&&o.focus()}this.rebuildValue()}}rebuildValue(){var e;let n="";this.keysPipe.transform(this.otpForm.controls).forEach(i=>{if(this.otpForm.controls[i].value){let o=this.otpForm.controls[i].value,a=o.length>1,h=!this.config.allowNumbersOnly&&this.config.letterCase&&("upper"==this.config.letterCase.toLocaleLowerCase()||"lower"==this.config.letterCase.toLocaleLowerCase());o=o[0];let m=h?"upper"==this.config.letterCase.toLocaleLowerCase()?o.toUpperCase():o.toLowerCase():o;h&&m==o?h=!1:o=m,n+=o,(a||h)&&this.otpForm.controls[i].setValue(o)}}),null!==(e=this.formCtrl)&&void 0!==e&&e.setValue&&this.formCtrl.setValue(n),this.onInputChange.emit(n),this.currentVal=n}handlePaste(e){let n=e.clipboardData||window.clipboardData;if(n)var i=n.getData("Text");e.stopPropagation(),e.preventDefault(),i&&(!this.config.allowNumbersOnly||this.validateNumber(i))&&this.setValue(i)}}return r.\u0275fac=function(e){return new(e||r)(t.rXU(f),t.rXU(c.qQ))},r.\u0275cmp=t.VBU({type:r,selectors:[["ng-otp-input"]],inputs:{config:"config",formCtrl:"formCtrl"},outputs:{onInputChange:"onInputChange"},decls:1,vars:1,consts:[["inp",""],[3,"class","id","ngStyle",4,"ngIf"],[3,"id","ngStyle"],["autocomplete","one-time-code",3,"pattern","type","placeholder","ngStyle","class","formControl","id","paste","keyup","input","keydown",4,"ngFor","ngForOf"],["autocomplete","one-time-code",3,"paste","keyup","input","keydown","pattern","type","placeholder","ngStyle","formControl","id"]],template:function(e,n){1&e&&t.DNE(0,C,3,9,"div",1),2&e&&t.Y8G("ngIf",null==n.otpForm?null:n.otpForm.controls)},dependencies:[c.bT,c.B3,c.Sq,l.me,l.R_,l.BC,l.l_,f],styles:[".otp-input[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:4px;border:solid 1px #c5c5c5;text-align:center;font-size:32px}.ng-otp-input-wrapper[_ngcontent-%COMP%]   .otp-input[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media screen and (max-width: 767px){.otp-input[_ngcontent-%COMP%]{width:40px;font-size:24px;height:40px}}@media screen and (max-width: 420px){.otp-input[_ngcontent-%COMP%]{width:30px;font-size:18px;height:30px}}"]}),r})(),I=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({providers:[f],imports:[[c.MD,l.YN,l.X1]]}),r})();var u=p(4702),b=p(4796),F=p(9350),w=p(5260);const N=()=>({length:4,allowNumbersOnly:!0});function V(r,s){if(1&r&&(t.j41(0,"ion-card-header")(1,"ion-card-title",9),t.EFF(2),t.k0s()()),2&r){const e=t.XpG();t.R7$(2),t.JRh(e.username)}}function k(r,s){1&r&&(t.j41(0,"ion-item")(1,"ion-label",10),t.EFF(2,"Email"),t.k0s(),t.nrm(3,"ion-input",11,0),t.k0s())}function P(r,s){1&r&&(t.j41(0,"ion-item")(1,"ion-label",10),t.EFF(2,"Password"),t.k0s(),t.nrm(3,"ion-input",12),t.k0s())}function S(r,s){if(1&r){const e=t.RV6();t.j41(0,"ion-item",13)(1,"ng-otp-input",14),t.bIt("onInputChange",function(i){t.eBV(e);const o=t.XpG();return t.Njj(o.onOtpComplete(i))}),t.k0s()()}2&r&&(t.R7$(),t.Y8G("config",t.lJ4(1,N)))}let T=(()=>{var r;class s{constructor(n,i,o,a){this.formBuilder=n,this.authService=i,this.toastController=o,this.router=a,this.pin=null,this.loginForm=this.createForm()}ngOnInit(){this.checkStoredEmailAndPin()}ionViewWillEnter(){this.checkStoredEmailAndPin()}createForm(){return this.formBuilder.group({email:["",[l.k0.required,l.k0.email]],password:["",[l.k0.required,l.k0.minLength(6)]],pin:["",[l.k0.required,l.k0.minLength(4),l.k0.maxLength(4)]]})}checkStoredEmailAndPin(){var n,i,o;this.pin=this.authService.getPin(),this.pin?(this.storedEmail=this.authService.getUser(),this.username=this.storedEmail.first_name+" "+this.storedEmail.last_name,null!==(n=this.storedEmail)&&void 0!==n&&n.email&&(this.loginForm.patchValue({email:this.storedEmail.email}),null===(i=this.loginForm.get("password"))||void 0===i||i.clearValidators(),this.loginForm.updateValueAndValidity())):(null===(o=this.loginForm.get("pin"))||void 0===o||o.clearValidators(),this.loginForm.updateValueAndValidity())}onSubmit(){if(this.loginForm.valid){const{email:n,password:i,pin:o}=this.loginForm.value;if(this.pin){if(!this.storedEmail.email)return void this.presentToast("Email not found. Please log in with email and password.");this.authService.login(n,void 0,o).subscribe(a=>{a.status?this.router.navigate(["/tabs"]):this.presentToast("Login with PIN failed. Please try again.")})}else this.authService.login(n,i).subscribe(a=>{a?this.router.navigate(["/create-pin"]):this.presentToast("Login failed. Please check your credentials.")})}}onOtpComplete(n){var i;console.log("OTP Submitted:",n),this.loginForm.patchValue({pin:n}),null===(i=this.loginForm.get("pin"))||void 0===i||i.updateValueAndValidity()}presentToast(n){var i=this;return(0,y.A)(function*(){yield(yield i.toastController.create({message:n,duration:2e3,position:"top"})).present()})()}}return(r=s).\u0275fac=function(n){return new(n||r)(t.rXU(l.ok),t.rXU(b.u),t.rXU(F.K_),t.rXU(w.Ix))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-login"]],standalone:!0,features:[t.aNF],decls:18,vars:8,consts:[["emailInput",""],[3,"translucent"],[3,"fullscreen"],[1,"login-container"],[4,"ngIf"],[3,"ngSubmit","formGroup"],["slot","end","lines","none",4,"ngIf"],["expand","full","type","submit",3,"disabled"],["fill","clear","routerLink","/register"],[1,"ion-text-center"],["position","floating"],["type","email","formControlName","email","required",""],["type","password","formControlName","password","required",""],["slot","end","lines","none"],[3,"onInputChange","config"]],template:function(n,i){1&n&&(t.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Login v1"),t.k0s()()(),t.nrm(4,"ion-content",2),t.j41(5,"ion-footer")(6,"ion-card",3),t.DNE(7,V,3,1,"ion-card-header",4),t.j41(8,"ion-card-content")(9,"form",5),t.bIt("ngSubmit",function(){return i.onSubmit()}),t.DNE(10,k,5,0,"ion-item",4)(11,P,4,0,"ion-item",4)(12,S,2,2,"ion-item",6),t.j41(13,"ion-button",7),t.EFF(14,"Login"),t.k0s(),t.j41(15,"div")(16,"ion-button",8),t.EFF(17,"Don't have an account? Register"),t.k0s()()()()()()),2&n&&(t.Y8G("translucent",!0),t.R7$(4),t.Y8G("fullscreen",!0),t.R7$(3),t.Y8G("ngIf",i.pin),t.R7$(2),t.Y8G("formGroup",i.loginForm),t.R7$(),t.Y8G("ngIf",!i.pin),t.R7$(),t.Y8G("ngIf",!i.pin),t.R7$(),t.Y8G("ngIf",i.pin),t.R7$(),t.Y8G("disabled",i.loginForm.invalid))},dependencies:[u.b_,u.M0,u.I9,u.ME,u.tN,u.eU,u.$w,u.W9,u.uz,u.ai,u.he,u.Jm,u.BC,c.MD,c.bT,l.YN,l.qT,l.BC,l.cb,l.YS,l.X1,l.j4,l.JD,I,v]}),s})()}}]);